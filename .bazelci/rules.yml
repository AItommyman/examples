#
# Bazel releases
#
lts: &lts
  bazel: latest

rolling: &rolling
  bazel: rolling

#
# Commmon features by platform
#
linux: &linux
  platform: ubuntu1804

macos: &macos
  platform: macos

windows: &windows
  platform: windows

#
# Test sets
#
basics: &basics
  working_directory: ../rules
  build_targets:
  - "..."
  test_targets:
  - "..."

configurations: &configurations
  working_directory: ../configurations
  build_targets:
  - "..."
  - "-//starlark_configurations/read_attr_in_transition:will-break"
  # These targest are not supposed to build at the top level without flags being set
  - "-//starlark_configurations/cc_binary_selectable_copts:app_forgets_to_set_features"
  - "-//starlark_configurations/cc_binary_selectable_copts:app_forgets_to_set_features_native_binary"
  - "-//starlark_configurations/cc_binary_selectable_copts:app_with_feature1_native_binary"
  - "-//starlark_configurations/cc_binary_selectable_copts:app_with_feature2_native_binary"
  - "-//starlark_configurations/cc_binary_selectable_copts:lib"
  # TODO(#160) renable this target when split_attr logic is released
  - "-//starlark_configurations/multi_arch_binary:foo"
  test_targets:
  - "..."

#
# Finally, the cross product of tests X platforms X bazel release
#
tasks:
  rule_basics_linux_lts5:
    name: rule_basics_linux_lts5
    <<: *linux
    <<: *lts
    <<: *basics

tasks:
  rule_basics_linux_latest:
    name: rule_basics_linux_latest
    <<: *linux
    <<: *rolling
    <<: *basics
